<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>MVG</title>

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
        <link rel="preconnect" href="https://fonts.gstatic.com">
        <link href="https://fonts.googleapis.com/css2?family=Bungee+Inline&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
        <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">

        <link rel="stylesheet" href="Administration/Accueil_Administratif/Style-Menu-Administration.css">
        <link rel="stylesheet" href="Administration/Gestion_Jeu/Style-Gestion-Jeu.css">
        <link rel="stylesheet" href="Menu/menu.css">

        <script src="Menu/menu.js"></script>
    </head>

    <body>
        <div id="menu"></div>

        <div id="wrapper" class="wrapper-content">
            <div id="sidebar-wrapper"></div>
            <div id="page-content-wrapper">
                <div class="container-fluid pt-5">
                    <div class="row d-flex w-100 no-gutters mt-5">                        
                        <div class="circle-tile mx-auto">
                            <div class="circle-tile-heading"><i class="fa fa-users fa-fw fa-3x"></i></div>
                            <div class="circle-tile-content">
                                <div class="circle-tile-description">Gestion des jeux</div>							
                                <div class="row no-gutters justify-content-center">
                                    <p class="circle-tile-number mt-2 mr-1">Total de jeux:</p>
                                    <p class="circle-tile-number mt-2" id="nombreJeux" ></p>
                                </div>                                    
                            </div>
                        </div>                                         
                    </div>
                    <div class="row mt-5 no-gutters px-5">
                        <div class="container-fluid" style="background-color: white;">
                            <h3 class="my-3 mx-auto" style="text-align: center;">Liste de jeux</h3>
                            <div class="row no-gutters">                                
                                <div class="card">
                                    <div class="card-body">
                                        <div class="table-responsive project-list">
                                            <table class="table project-table table-centered table-nowrap" style="color:black;">
                                                <thead>
                                                <tr>
                                                    <th scope="col">ID</th>
                                                    <th scope="col">Image</th>
                                                    <th scope="col">Nom</th>
                                                    <th scope="col">Catégorie</th>
                                                    <th scope="col">Studio</th>
                                                    <th scope="col">Éditeur</th>
                                                    <th scope="col">Prix</th>
                                                    <th scope="col">Rabais</th>
                                                    <th scope="col">Date de sortie</th>
                                                    <th scope="col">Modifier</th>
                                                    <th scope="col">Supprimer</th>

                                                </tr>
                                                </thead>

                                                <tbody>
                                                <!-- Chaque Nouvelle entrée -->
                                                <tr>
                                                    <th scope="row" width="1%;">1</th>
                                                    <th width="5%">
                                                        <img src="Images/Kingdom-Hearts-III.jpg" style="width: 60px; height: 80px;"/>
                                                    </th>
                                                    <th width="20%">Kingdom Hearts 3</th>
                                                    <th width="10%">Action</th>
                                                    <th width="10%">Square Enix</th>
                                                    <th width="10%">Square Enix</th>
                                                    <th>79.99$</th>
                                                    <th>0</th>
                                                    <th>2019-01-25</th>
                                                    <th width="5%">
                                                        <img src="Images/Modif.jpg" class="animationsBoutonsListe" onclick="ouvrirModalModif('Kingdom-Hearts-III.jpg','1','Kingdom Hearts 3', 'Action', 'Square Enix', 'Square Enix','79.99', '0', '2019-01-25')">
                                                    </th>
                                                    <th width="5%">
                                                        <img src="Images/supprimer.png" class="animationsBoutonsListe" onclick="supprimerObjetListe('2475')">
                                                    </th>
                                                </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                        <!-- end project-list -->
                                    </div>
                                </div>
                            </div>
                            <!-- end row -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

    <!-- The Modal -->
        <div id="myModal" class="modal mt-5 pt-5">

            <!-- Modal content -->
            <div class="modal-content pl-5">
                <span class="close">&times;</span>
                <div class="interieurModal">                    
                    <h2 id="titreModal"></h2>
                    <div class="row no-gutters">
                        <div class="col-sm-4  mx-auto">
                            <img id="imageModal">
                            <p id="nomImage" class="mt-3"></p>
                            <input type="file" id="fichierModal">                        
                        </div>
                        <div class="col-sm-8  mx-auto">
                            <h5 id="idTitre">Id du jeu</h5>
                            <input type="text" class="dispositionsInputs" id="idJeu" disabled>
                            <h5>Nom du jeu</h5>
                            <input type="text" placeholder="Nom du jeu" class="dispositionsInputs" id="nomJeu">
                            <h5>Catégorie</h5>
                            <select name="categorie" id="categorie" class="dispositionsInputs">
                                <option>Action</option>
                                <option>Sport</option>
                                <option>FPS</option>
                                <option>RPG</option>
                                <option>Course</option>
                                <option>Plateforme</option>
                                <option>Gestion</option>
                                <option>Jeux de société</option>
                                <option>Combat</option>
                                <option>Simulation</option>
                                <option>MMO</option>
                            </select>
                            <h5>Nom du studio</h5>
                            <input type="text" placeholder="Nom du studio du jeu" class="dispositionsInputs" id="nomStudio">
                            <h5>Nom de l'éditeur</h5>
                            <input type="text" placeholder="Nom de l'éditeur du jeu" class="dispositionsInputs" id="nomEditeur">
                            <h5>Prix</h5>
                            <input type="text" placeholder="Prix du jeu" class="dispositionsInputs" id="prixJeu">
                            <h5>Rabais</h5>
                            <input type="text" placeholder="Rabais du jeu (Sans pourcentage %)" class="dispositionsInputs" id="rabaisJeu">
                            <h5>Date de sortie</h5>
                            <input type="date" class="dispositionsInputs" id="dateSortie" min="1970-01-01">                            
                        </div>
                        <input type="button" id="boutonConfirmation">
                    </div>
                </div>
            </div>
        </div>
    </body>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
        /* Rechercher le nombre de jeux au total dans la BD */
        document.getElementById("nombreJeux").innerHTML = "5";

        // Get the modal
        var modal = document.getElementById("myModal");

        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];

        // Ouvre le modal de création de jeux
        function ouvrirModalAjout(){
            modal.style.display = "block";
            document.getElementById("titreModal").innerHTML = "Ajouter un jeu";
            document.getElementById("boutonConfirmation").value ="Ajouter";
            document.getElementById("nomImage").innerHTML = "inconnu.jpg";
            document.getElementById("imageModal").src ="Images/inconnu.jpg";
            $("#idTitre").hide()
            $("#idJeu").hide()
            document.getElementById("nomJeu").value ="";
            document.getElementById("categorie").selectedIndex = "-1";
            document.getElementById("nomStudio").value = "";
            document.getElementById('nomEditeur').value = "";
            document.getElementById('prixJeu').value = "";
            document.getElementById('rabaisJeu').value = "";
            document.getElementById('dateSortie').value = "";
        }

        function ouvrirModalModif(image, id, nom, categorie, studio, editeur, prix, rabais, date){
            modal.style.display = "block";
            $("#idTitre").show()
            $("#idJeu").show()
            document.getElementById("titreModal").innerHTML = "Modification de jeu";
            document.getElementById("boutonConfirmation").value ="Enregistrer les modifications";
            document.getElementById("imageModal").src ="Images/" + image;
            document.getElementById("idJeu").value = id;
            document.getElementById("nomJeu").value = nom;
            switch (categorie){
                case "Action":
                    document.getElementById("categorie").selectedIndex = "0";
                    break;
                case "Sport":
                    document.getElementById("categorie").selectedIndex = "1";
                    break;
                case "FPS":
                    document.getElementById("categorie").selectedIndex = "2";
                    break;
                case "RPG":
                    document.getElementById("categorie").selectedIndex = "3";
                    break;
                case "Course":
                    document.getElementById("categorie").selectedIndex = "4";
                    break;
                case "Plateforme":
                    document.getElementById("categorie").selectedIndex = "5";
                    break;
                case "Gestion":
                    document.getElementById("categorie").selectedIndex = "6";
                    break;
                case "Jeux de société":
                    document.getElementById("categorie").selectedIndex = "7";
                    break;
                case "Combat":
                    document.getElementById("categorie").selectedIndex = "8";
                    break;
                case "Simulation":
                    document.getElementById("categorie").selectedIndex = "9";
                    break;
                case "MMO":
                    document.getElementById("categorie").selectedIndex = "10";
                    break;

            }
            document.getElementById("nomStudio").value = studio;
            document.getElementById('nomEditeur').value = editeur;
            document.getElementById('prixJeu').value = prix;
            document.getElementById('rabaisJeu').value = rabais;
            document.getElementById('dateSortie').value = date;
        }

        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
            modal.style.display = "none";
        }

        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }

        $(document).ready(function (){
            $("#sidebar-wrapper").load('Menu-Administration.html')
            $("#menu").load('menu.html')
            $('#boutonConfirmation').click(function (e) {
                var bouton = document.getElementById("boutonConfirmation");
                var nom = document.getElementById("nomJeu");
                var categorie = document.getElementById("categorie");
                var studio = document.getElementById("nomStudio");
                var editeur = document.getElementById("nomEditeur");
                var prix = document.getElementById("prixJeu");
                var rabais = document.getElementById("rabaisJeu");
                var date = document.getElementById("dateSortie");
                var lien_image = document.getElementById("nomImage");

                if (nom.value == "" || categorie.selectedIndex == "-1" || studio.value == "" || editeur.value == "" || prix.value == "" || rabais.value == "" || date.value == ""){
                    alert("Veuillez choisir et remplir tous les champs");
                } else {
                    if (bouton.value == "Créer le jeu") {
                        /* Création de l'ID */
                        var id = nom.value.substring(0,3) + studio.value.substring(0,3) + (Math.floor(Math.random() * (9999 - 1111 + 1)) + 1111);
                        document.getElementById("idJeu").value = id;

                        /* Ajout Image dans le serveur*/


                        /* Ajout jeu dans la BD */
                            e.preventDefault()
                            $.ajax({
                                url: "Base_de_donnees/ajoutJeu.php",
                                type: "POST",
                                dataType: "json",
                                data: {
                                    "id_jeu": id,
                                    "nom": nom.value,
                                    "developpeur": studio.value,
                                    "editeur": editeur.value,
                                    "rating": '0',
                                    "prix": prix.value,
                                    "rabais": rabais.value,
                                    "date_de_sortie": date,
                                    "image_lien": lien_image.innerHTML
                                },
                                success: function (reponse) {
                                    console.log(reponse);
                                    alert("Le jeu a bien été ajouté");
                                },
                                error: function (message, e) {
                                    console.log(message);
                                }
                            });
                        /* Ajout de la catégorie */
                        var categorie = document.getElementById("categorie");
                        e.preventDefault()
                        $.ajax({
                            url: "Base_de_donnees/ajout_categorie",
                            type: "POST",
                            dataType: "json",
                            data: {
                                "id_jeu": id,
                                "categorie": categorie.options[categorie.selectedIndex].text
                            },
                            success: function (reponse) {
                                console.log(reponse);
                                alert("Le jeu a bien été ajouté");
                                location.reload();
                            },
                            error: function (message, e) {
                                console.log(message);
                            }
                        });

                    } else {
                        alert("Le jeu a bien été modifié");
                        location.reload();
                    }
                }

            });
        });

        //Pour la supression d'objets
        function supprimerObjetListe(id){
            if (confirm("Voulez-vous vraiment supprimer cet objet?")){
                alert("Oui");
                alert(id);
                location.reload();
            } else {
                alert("nope");
            }
        }
    </script>

</html>